# Отчет по ДЗ-10: Безопасность агентных систем

## Реализованные механизмы безопасности

### 1. Маскирование чувствительных данных (PII)
- Добавлен `PIIMiddleware` для маскирования номеров кредитных карт в ответах (`src/agent.py:107-113`); входящие сообщения не маскируются (`apply_to_input=False`).
- Опциональное маскирование email/телефонов не добавлялось.

### 2. Лимиты на вызовы
- ModelCallLimitMiddleware: лимит 20 вызовов модели (`src/agent.py:99-102`).
- ToolCallLimitMiddleware: лимит 20 вызовов инструментов (`src/agent.py:103-105`; комментарий в коде говорит о 2 вызовах, но фактическое значение — 20).

### 3. Human-in-the-Loop
- Инструменты требующие подтверждения:
  - `open_credit_card`
  - `open_deposit`
  (оба указаны в `HumanInTheLoopMiddleware`, `src/agent.py:115-125`)

### 4. Дополнительные фильтры (опционально)
- Дополнительные сканеры (LLM Guard и др.) не подключены.

## Сложности и решения

- Комментарии про лимит «2 вызова» не совпадают с параметром `run_limit=20`; для отчета зафиксированы реальные значения из middleware.
- PII-маскирование включено только для выходов модели, поэтому для защиты входящих номеров карт потребуются дополнительные настройки (например, `apply_to_input=True`), если будут собираться логи — отмечено как зона внимания.
- Дополнительных фильтров/сканеров в кодовой базе не нашлось, поэтому раздел отмечен как не реализованный.

## Инсайты

- Комбинация лимитов, маскирования PII и HITL покрывает основные высокорисковые точки (карты, вклады); конфигурация легко расширяется через `interrupt_on`.
- Разделение PII-маскировки только на вывод может быть полезно для UX, но при включенном логировании входов стоит усилить защиту, чтобы избежать утечек сырого номера карты.
